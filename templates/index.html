<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Emotion Music Recommend System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
</head>

<body>
  <div class="container my-5">
    <header class="text-center mb-5">
      <h1 class="display-4">Emotion Music Recommend System</h1>
      <p class="lead">Let your emotions guide your music experience</p>
    </header>

    <!-- User Authentication Section -->
    <div class="row mb-4" id="auth-section">
      <div class="col-md-6 offset-md-3">
        <div class="card">
          <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs" id="authTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login"
                  type="button" role="tab">
                  Login
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button"
                  role="tab">
                  Register
                </button>
              </li>
            </ul>
          </div>
          <div class="card-body">
            <div class="tab-content" id="authTabsContent">
              <div class="tab-pane fade show active" id="login" role="tabpanel">
                <form id="login-form">
                  <div class="mb-3">
                    <label for="login-username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="login-username" required />
                  </div>
                  <div class="mb-3">
                    <label for="login-password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="login-password" required />
                  </div>
                  <button type="submit" class="btn btn-primary">Login</button>
                </form>
              </div>
              <div class="tab-pane fade" id="register" role="tabpanel">
                <form id="register-form">
                  <div class="mb-3">
                    <label for="register-username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="register-username" required />
                  </div>
                  <div class="mb-3">
                    <label for="register-email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="register-email" required />
                  </div>
                  <div class="mb-3">
                    <label for="register-password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="register-password" required />
                  </div>
                  <button type="submit" class="btn btn-primary">
                    Register
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- User Info Section (hidden by default) -->
    <div class="row mb-4 d-none" id="user-section">
      <div class="col-md-12">
        <div class="card">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-md-4">
                <h5 class="card-title mb-1">Welcome, <span id="user-name">User</span>! üëã</h5>
                <p class="card-text text-muted mb-0" id="user-email">user@example.com</p>
              </div>
              <div class="col-md-8 text-end">
                <!-- PRIMARY ACTION BUTTON -->
                <button class="btn btn-primary btn-lg me-2" onclick="showEmotionDetection()"
                  style="font-size: 1.1rem; padding: 0.75rem 2rem;">
                  üé≠ Capture Emotion & Get Music
                </button>

                <!-- Secondary Buttons -->
                <button class="btn btn-outline-primary me-2" onclick="showDashboard()">
                  üìä Dashboard
                </button>
                <button class="btn btn-outline-success me-2" id="upload-btn" data-bs-toggle="modal"
                  data-bs-target="#uploadModal">
                  Upload Song
                </button>
                <button class="btn btn-outline-primary me-2" id="preferences-btn">
                  Preferences
                </button>
                <button class="btn btn-outline-primary me-2" id="favorites-btn">
                  Favorites
                </button>
                <button class="btn btn-outline-warning me-2 d-none" id="admin-panel-btn">
                  Admin Panel
                </button>
                <button class="btn btn-outline-danger" id="logout-btn">
                  Logout
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Preferences Modal -->
    <div class="modal fade" id="preferencesModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">User Preferences</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="preferences-form">
              <div class="mb-3">
                <label for="preferred-genre" class="form-label">Preferred Genre</label>
                <input type="text" class="form-control" id="preferred-genre" />
              </div>
              <div class="mb-3">
                <label for="preferred-artist" class="form-label">Preferred Artist</label>
                <input type="text" class="form-control" id="preferred-artist" />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Close
            </button>
            <button type="button" class="btn btn-primary" id="save-preferences">
              Save Preferences
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Upload Song Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Upload Your Song</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="upload-form">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="song-title" class="form-label">Song Title *</label>
                  <input type="text" class="form-control" id="song-title" required />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="song-artist" class="form-label">Artist Name *</label>
                  <input type="text" class="form-control" id="song-artist" required />
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="song-emotion" class="form-label">Emotion Tag *</label>
                  <select class="form-select" id="song-emotion" required>
                    <option value="">Select Emotion</option>
                    <option value="happy">Happy</option>
                    <option value="sad">Sad</option>
                    <option value="angry">Angry</option>
                    <option value="neutral">Neutral</option>
                    <option value="surprise">Surprise</option>
                    <option value="fear">Fear</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="song-valence" class="form-label">Valence (0-1)</label>
                  <input type="number" class="form-control" id="song-valence" min="0" max="1" step="0.1" value="0.5" />
                  <small class="text-muted">Positivity level</small>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="song-energy" class="form-label">Energy (0-1)</label>
                  <input type="number" class="form-control" id="song-energy" min="0" max="1" step="0.1" value="0.5" />
                  <small class="text-muted">Energy level</small>
                </div>
              </div>
              <div class="mb-3">
                <label for="audio-file" class="form-label">Audio File *</label>
                <input type="file" class="form-control" id="audio-file" accept=".mp3,.wav,.ogg,.flac,.m4a" required />
                <small class="text-muted">Supported formats: MP3, WAV, OGG, FLAC, M4A (Max
                  50MB)</small>
              </div>
            </form>
            <div id="upload-status"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Close
            </button>
            <button type="button" class="btn btn-primary" id="submit-upload">
              Upload Song
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard Section (NEW!) -->
    <div class="row mb-4 d-none main-section" id="dashboard-section">
      <div class="col-12">
        <!-- Dashboard Header -->
        <div class="card glass-card mb-4">
          <div class="card-body">
            <h2 class="text-gradient mb-0">üìä Your Music & Emotion Dashboard</h2>
            <p class="text-muted">Track your emotions and listening habits</p>
          </div>
        </div>

        <!-- Stats Cards Row -->
        <div class="row mb-4">
          <div class="col-md-3 col-sm-6 mb-3">
            <div class="stat-card">
              <div class="stat-number" id="total-captures">0</div>
              <div class="stat-label">Emotions Captured</div>
            </div>
          </div>
          <div class="col-md-3 col-sm-6 mb-3">
            <div class="stat-card">
              <div class="stat-number" id="total-songs-played">0</div>
              <div class="stat-label">Songs Played</div>
            </div>
          </div>
          <div class="col-md-3 col-sm-6 mb-3">
            <div class="stat-card">
              <div class="stat-number" id="favorite-emotion">üòä</div>
              <div class="stat-label">Top Emotion</div>
            </div>
          </div>
          <div class="col-md-3 col-sm-6 mb-3">
            <div class="stat-card">
              <div class="stat-number" id="top-genre">üéµ</div>
              <div class="stat-label">Top Genre</div>
            </div>
          </div>
        </div>

        <!-- Main Dashboard Content -->
        <div class="row">
          <!-- Left Column: Emotion History -->
          <div class="col-lg-6 mb-4">
            <div class="card h-100">
              <div class="card-header">
                <h5 class="mb-0">üòä Emotion History</h5>
              </div>
              <div class="card-body" style="max-height: 500px; overflow-y: auto;">
                <div id="emotion-history-list">
                  <div class="empty-state">
                    <div class="empty-state-icon">üòê</div>
                    <div class="empty-state-text">Loading emotion history...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column: Emotion Statistics -->
          <div class="col-lg-6 mb-4">
            <div class="card h-100">
              <div class="card-header">
                <h5 class="mb-0">üìà Emotion Distribution</h5>
              </div>
              <div class="card-body">
                <div id="emotion-stats-container">
                  <div class="empty-state">
                    <div class="empty-state-text">Loading statistics...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Second Row: Listening History & Most Played -->
        <div class="row">
          <!-- Listening History -->
          <div class="col-lg-8 mb-4">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">üéµ Recently Played</h5>
              </div>
              <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                <div id="listening-history-list">
                  <div class="empty-state">
                    <div class="empty-state-icon">üéµ</div>
                    <div class="empty-state-text">Loading listening history...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Most Played Songs -->
          <div class="col-lg-4 mb-4">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">üî• Top Songs</h5>
              </div>
              <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                <div id="most-played-list">
                  <div class="empty-state">
                    <div class="empty-state-icon">üéß</div>
                    <div class="empty-state-text">Loading top songs...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Application Section (hidden until logged in) -->
    <div class="row d-none main-section" id="app-section">
      <!-- Navigation Tabs -->
      <div class="col-12 mb-3">
        <div class="card">
          <div class="card-body">
            <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" onclick="showDashboard()" type="button">
                  üìä Dashboard
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button">
                  üé≠ Emotion Detection
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" onclick="showFavorites()" type="button">
                  ‚ù§Ô∏è Favorites
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Emotion Detection Content -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h3>Real-time Emotion Detection</h3>
          </div>
          <div class="card-body">
            <div class="camera-container">
              <video id="video" width="100%" autoplay playsinline></video>
              <canvas id="canvas" class="d-none"></canvas>
            </div>
            <div class="emotion-result mt-3">
              <h4>
                Detected Emotion:
                <span id="emotion-label" class="badge bg-primary">None</span>
              </h4>
              <p>Confidence: <span id="confidence">0%</span></p>
            </div>
            <div class="actions mt-3">
              <button id="capture-btn" class="btn btn-primary">
                Capture Emotion
              </button>
              <button id="start-cam" class="btn btn-success">
                Start Camera
              </button>
              <button id="stop-cam" class="btn btn-danger">
                Stop Camera
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h3>Music Recommendations</h3>
            <button class="btn btn-sm btn-outline-secondary" id="refresh-btn">
              Refresh
            </button>
          </div>
          <div class="card-body">
            <div class="recommendations">
              <p id="no-recommendations" class="text-muted">
                No recommendations yet. Capture your emotion first!
              </p>
              <ul id="song-list" class="list-group"></ul>
            </div>

            <div class="audio-player mt-4">
              <h4>Now Playing</h4>
              <div class="current-song">
                <p id="now-playing" class="text-muted">No song selected</p>
              </div>
              <audio id="audio-player" controls class="w-100"></audio>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Favorites Section (hidden by default) -->
    <div class="row mb-4 d-none" id="favorites-section">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h3>Your Favorite Songs</h3>
          </div>
          <div class="card-body">
            <div id="no-favorites" class="text-muted">
              You haven't added any favorites yet.
            </div>
            <ul id="favorites-list" class="list-group"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>

</html>